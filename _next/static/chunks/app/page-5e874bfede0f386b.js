(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{2469:(t,e,a)=>{"use strict";a.d(e,{l:()=>x,default:()=>b});var r=a(5155),l=a(2115),n=a(6754);let s=(t,e)=>{let a=t.map(t=>t=t/360*(2*Math.PI));return n.pie().startAngle(a[0]).endAngle(a[1]).value(t=>t.prisonCount).sort((t,a)=>n[e](t.pieOrder,a.pieOrder))},i={id:"",type:"",municipality:"",region:"Friuli Venezia Giulia",suicides:0,attemptedSuicides:0,selfHarm:0,regulatoryRooms:0,nonRegulatoryRooms:0,totalPrisoners:0,overcrowdingAbsolute:0,overcrowdingPercent:0,expectedPolice:0,realPolice:0,differenceInPoliceNumbers:0,top30SelfHarm:!1,top30Suicides:!1},c=(t,e)=>{let a=n.group(t,t=>t.region),r=Array.from(a.keys()).reduce((t,r,l)=>{0===l&&(t={top:[],bottom:[]});let s=e.find(t=>t.region===r),c=a.get(r);return s&&c&&(c=c.sort((t,e)=>n["top"===s.circle?"descending":"ascending"](t.overcrowdingPercent,e.overcrowdingPercent)),"Friuli Venezia Giulia"===r&&c.unshift(i),t[s.circle].push({name:s.shortName,pieOrder:s.northToSouthOrder,prisonCount:c.length,data:c})),t},{}),l=s([7,200],"ascending")(r.top);return{pieTopData:l,pieBottomData:s([194,380],"descending")(r.bottom),maxPrisons:n.max(Array.from(a),t=>t[1].length)}},o=(t,e)=>{let a=t.exec(e);return a&&a.length>1?a[1]:""},d=(t,e,a)=>{let r=n.arc().outerRadius(a-e/2).innerRadius(a-1-e/2)(t)||"",l=o(/(^.+?)L/,r);if(""!==l&&(l=l.replace(/,/g," "),t.startAngle>=Math.PI/2&&t.startAngle<=1.5*Math.PI)){let t=o(/0 0 1 (.*?)$/,l),e=o(/M(.*?)A/,l);return"M"+t+"A"+o(/A(.*?)0 0 1/,l)+"0 0 0 "+e}return r},p=(t,e,a)=>{let r={startAngle:n.min(t,t=>t.startAngle)||0,endAngle:n.max(t,t=>t.endAngle)||0};return Array.from({length:11}).map((t,e)=>e/10).reduce((t,l)=>{let s=e(l)||0,i=n.arc().innerRadius(s).outerRadius(s),c=x.darkGrey;(1===l&&"top"===a||0===l&&"bottom"===a)&&(c="transparent"),(.5===l||0===l&&"top"===a||1===l&&"bottom"===a)&&(c="white");let o=i(r)||"";return t.push({path:o,value:l,fill:c}),t},[])},h=()=>{let t="".concat(-2,",").concat(-2),e="".concat(2,",").concat(-2),a="".concat(-2,",").concat(2),r="".concat(2,",").concat(2),l="M".concat(t,"L").concat(e,"L").concat(r,"L").concat(a,"Z"),s=1.4*Math.PI/3,i=-(.7*Math.PI),c=n.arc().padAngle(.2).cornerRadius(.5).innerRadius(4).outerRadius(5);return{squarePath:l,circularArcs:Array.from({length:3},(t,e)=>e+1).reduce((t,e,a)=>{let r=a*s,l=c({startAngle:i+r,endAngle:i+r+s});return l&&t.push(l),t},[])}},u=(t,e,a,r,l,s)=>{let i=s(t.overcrowdingPercent/100),c=n.lineRadial().angle(t=>t[0]).radius(t=>t[1]),o=c([[e,s.range()[0]],[a,i]])||"",d=o.split("L")[1].split(",").reduce((t,e)=>(t.push(+e),t),[]);return{linePath:o,endCoord:d,angleAsDegrees:e/(2*Math.PI)*360,stroke:r,dashArray:l,data:t}},g=(t,e,a,r)=>{let l=t=>0===t?e:1===t?e-a/3.5:e+a/3.5,n=[];if(t.suicides>0&&n.push(u(t,e,e,x.red,"4,4",r)),t.top30Suicides){let a=l(n.length);n.push(u(t,a,e,"white","4,4",r))}if(t.top30SelfHarm){let a=l(n.length);n.push(u(t,a,e,"white","2,2",r))}return 0===n.length&&n.push(u(t,e,e,"white","",r)),n.map((t,e)=>t.showSquare=0===e),n.reverse()},f=(t,e)=>{t.select(".legendTitle").attr("font-size",12).attr("fill","white").text("How to read");let{0:a,1:r}=e.domain(),l=[1,5,r],s=t.select(".circlesGroup").selectAll(".legendCircleGroup").data(l).join(t=>{let e=t.append("g").attr("class","legendCircleGroup");return e.append("circle").attr("class","legendCircle"),e.append("text").attr("class","legendCircleLabel"),e});s.attr("transform","translate(".concat(1+e(r),",",15,")")),s.select(".legendCircle").attr("r",t=>e(t)).attr("fill","transparent").attr("stroke","white").attr("stroke-width",.5).attr("cy",t=>2*e(r)-e(t)),s.select(".legendCircleLabel").attr("text-anchor","middle").attr("fill","white").attr("font-size",4).attr("y",t=>-1+2*e(r)-2*e(t)).text(t=>t);let i=[{line:!0,y:-e(r)/2,x0:e(r)/2,x1:6*e(r),fontSize:6,textAnchor:"left",wrapWidth:65,dy:-7,label:"Circle dimensions: total number of prisons in the region"},{line:!0,y:e(r)-e(a),x0:0,x1:2*e(r),fontSize:6,textAnchor:"left",wrapWidth:60,dy:-7,label:"Total number of suicides in the region's prisons"},{line:!1,y:e(r)-e(a),x0:0,x1:0,fontSize:6,textAnchor:"middle",wrapWidth:0,dy:0,label:"X"}],c=t.select(".circleLabelsGroup").selectAll(".legendCircleLabelGroup").data(i).join(t=>{let e=t.append("g").attr("class","legendCircleLabelGroup");return e.append("line").attr("class","legendCircleLabelLine"),e.append("text").attr("class","legendCircleLabelText"),e});c.attr("transform",t=>"translate(".concat(1+e(r),",").concat(15+e(r)+t.y,")")),c.select(".legendCircleLabelLine").filter(t=>t.line).attr("x1",t=>t.x0).attr("x2",t=>t.x1-3).attr("stroke","black").attr("stroke-width",.5),c.select(".legendCircleLabelText").attr("transform",t=>"translate(".concat(t.x1,",").concat(t.dy,")")).attr("fill","white").style("font-size",t=>t.fontSize).attr("text-anchor",t=>t.textAnchor).attr("dominant-baseline","middle").attr("dy",t=>t.dy).text(t=>t.label),n.selectAll(".legendCircleLabelText").filter(t=>t.line).each((t,e,a)=>{m(n.select(a[e]),t.wrapWidth)});let o=[{stroke:x.red,strokeDashArray:"4,4",label:"Prisons with one or more suicides",x:40,length:125},{stroke:"white",strokeDashArray:"4,4",label:"Top 30 prisons with attempted suicides",x:55,length:80},{stroke:"white",strokeDashArray:"2,2",label:"Top 30 prisons with self-harm cases",x:45,length:55},{stroke:"white",strokeDashArray:"",label:"No special cases to mention",x:25,length:45}],d=t.select(".linesGroup").selectAll(".linesDataGroup").data(o).join(t=>{let e=t.append("g").attr("class","linesDataGroup");return e.append("text").attr("class","lineDataLabel"),e.append("line").attr("class","lineDataLine"),e});d.attr("transform",(t,e)=>"translate(0,".concat(70+18*e,")")),d.select(".lineDataLabel").attr("fill","white").style("font-size",6).attr("dominant-baseline","middle").text(t=>t.label),d.select(".lineDataLine").attr("stroke",t=>t.stroke).attr("stroke-dasharray",t=>t.strokeDashArray).attr("stroke-width",1).attr("x1",t=>t.x).attr("x2",t=>t.x+t.length).attr("y1",7.5).attr("y2",7.5),n.selectAll(".lineDataLabel").each((t,e,a)=>{m(n.select(a[e]),53)}),t.select(".policeTitle").attr("font-size",6).attr("fill","white").attr("text-anchor","middle").attr("transform","translate(".concat(210,",",75,")")).text("Shortage of police staff").call(m,40);let{squarePath:p,circularArcs:u}=h();t.select(".policeSquare").attr("fill","white").attr("d",p).attr("transform","translate(".concat(210,",",65,")"));let g=t.select(".policePathsGroup").selectAll(".legendPathsGroup").data(u).join(t=>{let e=t.append("g").attr("class","legendPathsGroup");return e.append("path").attr("class","policeStaffCurve"),e});g.attr("transform","translate(".concat(210,",",65,")")),g.select(".policeStaffCurve").attr("d",t=>t).attr("fill","white");let f=t.select(".policeLinesGroup").selectAll(".legendPoliceLinesGroup").data([{path:"M-7,0L-15,0L-15,-15",x:-15,title:"Low",label:"<15 ppl"},{path:"M0,-6L0,-35",x:0,title:"Medium",label:"16-30ppl"},{path:"M7,0L15,0L15,-15",x:15,title:"High",label:"31> ppl"}]).join(t=>{let e=t.append("g").attr("class","legendPoliceLinesGroup");return e.append("text").attr("class","policeLineLabelValue"),e.append("text").attr("class","policeLineLabelTitle"),e.append("path").attr("class","policeLinePath"),e});f.attr("transform","translate(".concat(210,",",65,")")),f.select(".policeLinePath").attr("fill","none").attr("stroke","black").attr("stroke-width",.75).attr("d",t=>t.path),f.select(".policeLineLabelValue").attr("fill","white").attr("font-size",6).attr("text-anchor","middle").attr("x",t=>t.x).attr("y",t=>-18-20*(0===t.x)).text(t=>t.label),f.select(".policeLineLabelTitle").attr("fill","white").attr("font-size",6).attr("text-anchor","middle").attr("text-decoration","underline").attr("x",t=>t.x).attr("y",t=>-26-20*(0===t.x)).text(t=>t.title)},m=(t,e)=>{t.each(function(){n.select(this).selectAll("tspan").remove();let t=n.select(this).text().split(/\s+/).reverse(),a="",r=[],l=0,s=n.select(this).text(null).append("tspan").attr("x",0).attr("y",0).attr("dy","".concat(0,"em"));for(;a=t.pop()||"";){r.push(a),s.text(r.join(" "));let t=s.node()||void 0;t&&t.getComputedTextLength()>e&&(r.pop(),s.text(r.join(" ")),r=[a],s=n.select(this).append("tspan").attr("x",0).attr("y",0).attr("dy",1.1*++l+0+"em").text(a))}})},x={background:"#24242e",darkGrey:"#484751",lightGrey:"#ababba",red:"#cc0e0e"},b=t=>{let{containerClass:e,chartData:a,regionData:s}=t,i=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(!i.current)return;let t=n.select(i.current);if(!t.node())return;let r=n.select(".".concat(e,"Container")).node();if(!r)return;let{clientHeight:l}=r,o=1e3/1.4,u=1e3/1.4*.378,b={left:10,right:10,top:15,bottom:20};t.attr("viewBox",[0,0,o,1e3]).attr("width",l/1.4).attr("height",l),t.select(".chartTitle").attr("font-size",30).attr("font-weight",500).attr("transform","translate(0,45)").attr("fill","white").text("The dramatic conditions of Italian prisons, focus 2024").call(m,.55*o),t.select(".chartInfo1").attr("font-size",10).attr("transform","translate(0,110)").attr("fill","white").text("In 2024, the Italian prison system faced a severe crisis due to overcrowding. Out of 188 penitentiary institutions, 138 exceeded their official capacity, highlighting increasing pressure on both facilities and staff. The analysis focuses on 100 of these 138 overcrowded prisons in the twenty regions of Italy, starting from the North, providing a representative overview of the most critical issues: suicides, attempted suicides and self-harm cases are not uncommon and are often strictly connected to overcrowding. The severe shortage of prison staff is another crucial problem: the disparity between the planned number of correctional officers and the actual workforce is often striking, leading to increased stress, safety concerns, and management difficulties within the facilities.").call(m,.6*o),t.select(".chartInfo2").attr("font-size",10).attr("transform","translate(0,220)").attr("fill","white").text("The project Liberiamoli tutti! for the campaign #DatiBeneComune has provided valuable data for this analysis, revealing the significant gap between the official capacity and the actual number of inmates in many facilities. Can we change the narrative when we are aware of the issues?").call(m,.6*o);let A=(e,a,r,l,s)=>{let i=2*u,c=b.top+i-10-(1e3-b.bottom-i+10)-20-7.2,f=u-10-c,m=u-10,A=n.scaleLinear().domain([0,1]).range("top"===a?[f,m]:[m,f]),y=A(1)-A(.9),L=n.arc().outerRadius(u).innerRadius(u-10),w=n.arc().innerRadius(u-c-10-2.5).outerRadius(u-c-10+2.5),k="top"===a?.19:n.min(e,t=>t.startAngle)||0;t.select(".".concat(a,"StartRegionLine")).attr("stroke","white").attr("transform","translate(".concat(r,",").concat(l,")")).attr("d",w({startAngle:k,endAngle:k}));let G=t.select(".arcGroup").selectAll(".pieGroup".concat(a)).data(e).join(t=>{let e=t.append("g").attr("class","pieGroup".concat(a));return e.append("path").attr("class","backgroundArc"),e.append("path").attr("class","labelArc"),e.append("text").attr("class","labelText").append("textPath").attr("class","labelTextPath"),e.append("path").attr("class","regionLine"),e.append("circle").attr("class","prisonCircleItem prisonCountCircle"),e.append("text").attr("class","prisonCircleItem prisonCountCircleLabel"),e.append("g").attr("class","prisonsGroup"),e});G.attr("transform","translate(".concat(r,",").concat(l,")")),G.select(".regionLine").attr("stroke","white").attr("d",t=>w({startAngle:t.startAngle,endAngle:t.startAngle})),G.select(".prisonCountCircle").attr("fill",t=>t.data.pieOrder%2==0?x.lightGrey:x.darkGrey).attr("r",t=>s(t.data.data.length)),G.select(".prisonCountCircleLabel").attr("font-size",8).attr("dy",1).attr("text-anchor","middle").attr("fill",t=>t.data.pieOrder%2==0?x.darkGrey:x.lightGrey).attr("dominant-baseline","middle").text(t=>0===n.sum(t.data.data,t=>t.suicides)?"":n.sum(t.data.data,t=>t.suicides)),n.selectAll(".prisonCircleItem").attr("transform",t=>{let e=t.startAngle+(t.endAngle-t.startAngle)/2,a=n.arc().innerRadius(u-c-10-25).outerRadius(u-c-10-25).centroid({startAngle:e,endAngle:e});return"translate(".concat(a[0],",").concat(a[1],")")}),G.select(".backgroundArc").attr("fill",t=>t.data.pieOrder%2==0?x.lightGrey:x.darkGrey).attr("d",L),G.select(".labelArc").attr("id",(t,e)=>"labelPath".concat(a).concat(e)).attr("fill","transparent").attr("d",t=>d(t,10,u)),G.select(".labelText").attr("dy",.5).attr("fill",t=>t.data.pieOrder%2==0?x.darkGrey:x.lightGrey).attr("dominant-baseline","middle"),G.select(".labelTextPath").attr("startOffset",t=>t.startAngle>=Math.PI/2&&t.startAngle<=1.5*Math.PI?"50%":"25%").attr("font-size",6).attr("text-anchor","middle").attr("xlink:href",(t,e)=>"#labelPath".concat(a).concat(e)).text(t=>t.data.name.toUpperCase()),t.select(".scaleBackgroundRect").attr("fill",x.background).attr("x",o-u+12).attr("y",b.top).attr("width",15).attr("height",c+20);let C=p(e,A,a),P=t.select(".scaleGroup").selectAll(".percentageArcGroup".concat(a)).data(C).join(t=>{let e=t.append("g").attr("class","percentageArcGroup".concat(a));return e.append("path").attr("class","scaleArc"),e});P.attr("transform","translate(".concat(r,",").concat(l,")")),P.select(".scaleArc").attr("stroke",t=>t.fill).attr("stroke-width",.5).attr("fill","none").attr("d",t=>t.path);let v=t.select(".scaleLabelGroup").selectAll(".percentageArcLabelGroup".concat(a)).data(C).join(t=>{let e=t.append("g").attr("class","percentageArcLabelGroup".concat(a));return e.append("text").attr("class","scaleLabel"),e});v.attr("transform","translate(".concat(r,",").concat(l,")")),v.select(".scaleLabel").attr("fill",t=>"transparent"===t.fill?"white":t.fill).attr("text-anchor","middle").attr("x",28).attr("dominant-baseline","middle").attr("y",(t,e)=>b.top-u+e*y).attr("font-size","6").text(t=>"bottom"===a?"":n.format(".0f")((1-t.value)*100));let j=G.select(".prisonsGroup").selectAll(".prisonGroup".concat(a)).data(t=>{let e=t.data.data,a=(t.endAngle-t.startAngle)/(e.length+1);return e.reduce((e,r,l)=>{let n=t.startAngle+l*a+a;return e.push({data:r,lines:g(r,n,a,A)}),e},[])}).join(t=>{let e=t.append("g").attr("class","prisonGroup".concat(a));return e.append("g").attr("class","prisonLines"),e}).select(".prisonLines").selectAll(".prisonLineGroup".concat(a)).data(t=>t.lines).join(t=>{let e=t.append("g").attr("class","prisonLineGroup".concat(a));return e.append("path").attr("class","prisonLine"),e.append("path").attr("class","policeSquare"),e.append("g").attr("class","pieArcs"),e});j.select(".prisonLine").attr("stroke",t=>t.stroke).attr("stroke-dasharray",t=>t.dashArray).attr("stroke-width",1).attr("d",t=>t.linePath),j.select(".policeSquare").attr("d",t=>t.showSquare?h().squarePath:"").attr("fill",t=>t.stroke).attr("transform",t=>"translate(".concat(t.endCoord[0],",").concat(t.endCoord[1],") rotate(").concat(t.angleAsDegrees,")")),j.select(".pieArcs").attr("transform",t=>"translate(".concat(t.endCoord[0],",").concat(t.endCoord[1],") rotate(").concat("top"===a?t.angleAsDegrees:t.angleAsDegrees-180,")"));let S=h().circularArcs,N=n.scaleThreshold().domain([1,16,31]).range([0,1,2,3]);j.select(".pieArcs").selectAll(".policeStaffArcs".concat(a)).data(t=>S.slice(0,N(t.data.differenceInPoliceNumbers)).reduce((e,a)=>(e.push({path:a,stroke:t.stroke}),e),[])).join(t=>{let e=t.append("g").attr("class","policeStaffArcs".concat(a));return e.append("path").attr("class","policeStaffCurve"),e}).select(".policeStaffCurve").attr("d",t=>t.path).attr("fill",t=>t.stroke)},{pieTopData:y,pieBottomData:L,maxPrisons:w}=c(a,s),k=n.scaleSqrt().domain([1,w||0]).range([5,15]).clamp(!0);A(y,"top",o-b.right-u,b.top+u,k),A(L,"bottom",b.left+u,1e3-b.bottom-u,k),f(t.select(".legendGroup").attr("transform","translate(0,280)"),k)},[e,a,s]),(0,r.jsxs)("svg",{ref:i,children:[(0,r.jsx)("text",{className:"chartTitle"}),(0,r.jsx)("text",{className:"chartInfo1"}),(0,r.jsx)("text",{className:"chartInfo2"}),(0,r.jsxs)("g",{className:"legendGroup",children:[(0,r.jsx)("text",{className:"legendTitle"}),(0,r.jsx)("g",{className:"circlesGroup"}),(0,r.jsx)("g",{className:"circleLabelsGroup"}),(0,r.jsx)("g",{className:"linesGroup"}),(0,r.jsx)("text",{className:"policeTitle"}),(0,r.jsx)("path",{className:"policeSquare"}),(0,r.jsx)("g",{className:"policePathsGroup"}),(0,r.jsx)("g",{className:"policeLinesGroup"})]}),(0,r.jsx)("g",{className:"scaleGroup"}),(0,r.jsx)("g",{className:"arcGroup"}),(0,r.jsx)("rect",{className:"scaleBackgroundRect"}),(0,r.jsx)("g",{className:"scaleLabelGroup"}),(0,r.jsx)("path",{className:"topStartRegionLine"}),(0,r.jsx)("path",{className:"bottomStartRegionLine"})]})}},4987:(t,e,a)=>{Promise.resolve().then(a.bind(a,2469))}},t=>{var e=e=>t(t.s=e);t.O(0,[754,441,684,358],()=>e(4987)),_N_E=t.O()}]);